using System;
using System.Threading;
using UnityEditor;

namespace SpoiledCat.Threading
{
	using Utilities;

	public interface IMainThreadSynchronizationContext
	{
		void Schedule(Action action);
	}

	public class UnityUIThreadSynchronizationContext : SynchronizationContext, IMainThreadSynchronizationContext
	{
		public void Schedule(Action action)
		{
			Guard.ArgumentNotNull(action, "action");
			Post(act => ((Action)act)(), action);
		}

		public override void Post(SendOrPostCallback d, object state)
		{
			if (d == null)
				return;

			EditorApplication.delayCall += () => d(state);
		}
	}
}
