version: '{build}'

nuget:
  disable_publish_on_pr: true

configuration: Release

environment:
   # Don't report back to the mothership
  DOTNET_CLI_TELEMETRY_OPTOUT: 1

install:
- ps: scripts\Get-Deps.ps1

before_build:
- dotnet --info
- appveyor-retry dotnet restore -v Minimal

build_script:
- dotnet build -c %CONFIGURATION%

test:
  assemblies:
    only:
      - '**\*.Tests.dll'

after_test:
- dotnet pack -c %CONFIGURATION%

artifacts:
- path: build\**\*.nupkg
  name: NuGet

for:
-
  branches:
    except:
    - /^v\d+(?:\.\d+)?$/
  skip_tags: true
  skip_commits:
    files:
    - doc/*
    - README.md

-
  branches:
    only:
    - /^v\d+(?:\.\d+)?$/
  skip_tags: false
  skip_commits:
    files:
    - doc/*
    - README.md

  deploy:
    provider: NuGet
    server:                  # remove to push to NuGet.org
    api_key:
      secure: KNFSKb7s+3+79G+FOMmubE+llHdsyV+3ApSqqgrbia5DM4RCzKDEIXaQGPqip9bf
    skip_symbols: true
    symbol_server:           # remove to push symbols to SymbolSource.org
    artifact: /.*\.nupkg/
    on:
      APPVEYOR_REPO_TAG: true

  after_deploy:
    - npm config set //registry.spoiledcat.com/:_authToken %NPM_TOKEN%
    - npm config set always-auth true
    - ps: |
        if ($env:APPVEYOR_REPO_TAG -eq "true") {

        }
